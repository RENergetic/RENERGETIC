apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-ini
data:
  grafana.ini: |
    [server]
      domain = localhost
      root_url = http://localhost/grafana/
      serve_from_sub_path = true
    [security]
      allow_embedding = true
    [auth]
      oauth_auto_login = true
      signout_redirect_url = http://localhost/auth/realms/realm-renergetic/protocol/openid-connect/logout?redirect_uri=http%3A%2F%2Flocalhost%2Fgrafana%2F
    [auth.anonymous]
      enabled = true
      org_name = external
      org_role = Viewer
      hide_version = true
    [auth.generic_oauth]
      enabled = true
      allow_sign_up = true
      name = OAuth
      allow_sign_up = true
      client_id = grafana
      client_secret = 37e35f3f-ef01-494c-8103-0e87bd29e3e8
      auth_url = http://localhost/auth/realms/realm-renergetic/protocol/openid-connect/auth
      token_url = http://keycloak-sv:8080/auth/realms/realm-renergetic/protocol/openid-connect/token
      api_url = http://keycloak-sv:8080/auth/realms/realm-renergetic/protocol/openid-connect/userinfo
      scopes = openid email profile
      id_token_attribute_name = access_token
      email_attribute_name = email:primary
      login_attribute_path = preferred_username
      role_attribute_path = contains(resource_access.grafana.roles, 'admin') && 'Admin' || contains(resource_access.grafana.roles, 'editor') && 'Editor' || 'Viewer'
      org_attribute_path = 1
      use_pkce = false
    [log]
      mode=console file
      level=debug
      filters = oauth:debug oauth.generic_oauth:debug
