"use strict";(self["webpackChunkrenergetic_ui"]=self["webpackChunkrenergetic_ui"]||[]).push([[533],{4533:function(e,s,l){l.r(s),l.d(s,{default:function(){return E}});var a=l(6252),t=l(3577);const i=e=>((0,a.dD)("data-v-7dd8a968"),e=e(),(0,a.Cn)(),e),o={key:0,class:"orders-subtable",style:{margin:"0 2rem"}},r={key:2,class:"grid p-fluid",style:{margin:"0 2rem"}},d={class:"col-12 md:col-4"},n={class:"p-inputgroup"},u=["onChange"],c=["value"],m={class:"confirmation-content"},p=i((()=>(0,a._)("i",{class:"pi pi-exclamation-circle mr-3",style:{"font-size":"2rem",margin:"0em 0.4em"}},null,-1))),h={key:0};function v(e,s,l,i,v,g){const b=(0,a.up)("Column"),f=(0,a.up)("Button"),y=(0,a.up)("DataTable"),w=(0,a.up)("Message"),k=(0,a.up)("Toolbar"),U=(0,a.up)("Dialog"),D=(0,a.up)("UserAdd");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(y,{expandedRows:v.users.roles,"onUpdate:expandedRows":s[0]||(s[0]=e=>v.users.roles=e),value:v.users,"data-key":"id","responsive-layout":"scroll"},{expansion:(0,a.w5)((e=>[void 0!=e.data.roles&&e.data.roles.length>0?((0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(y,{value:e.data.roles,"responsive-layout":"scroll"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{exportable:!1,style:{"min-width":"8rem"}},{body:(0,a.w5)((s=>[(0,a.Wm)(f,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:l=>g.openDialog("deleteRole",e.data,s.data)},null,8,["onClick"])])),_:2},1024),(0,a.Wm)(b,{field:"name",header:"Role Name",sortable:""})])),_:2},1032,["value"])])):((0,a.wg)(),(0,a.j4)(w,{key:1,severity:"info"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(`${e.data.username} haven't assigned roles`),1)])),_:2},1024)),g.availableRoles(e.data).length>0?((0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("div",d,[(0,a._)("div",n,[(0,a._)("select",{class:"p-component",style:{width:"100%","text-align":"center"},onChange:s=>g.selectRole(s,e.data)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(g.availableRoles(e.data),(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:JSON.stringify(e)},(0,t.zw)(e.name),9,c)))),128))],40,u),(0,a.Wm)(f,{icon:"pi pi-plus",class:"p-button-success",onClick:s=>g.addRole(e.data)},null,8,["onClick"])])])])):(0,a.kq)("",!0)])),default:(0,a.w5)((()=>[(0,a.Wm)(b,{expander:!0,"header-style":"width: 3rem"}),(0,a.Wm)(b,{field:"username",header:"Username",sortable:""}),(0,a.Wm)(b,{field:"name",header:"Name",sortable:""}),(0,a.Wm)(b,{field:"email",header:"Email",sortable:""}),(0,a.Wm)(b,{exportable:!1,style:{"min-width":"8rem"}},{body:(0,a.w5)((e=>[(0,a.Wm)(f,{icon:"pi pi-user-edit",class:"p-button-rounded p-button-warning mr-2",onClick:s=>{v.userToEdit=e.data,v.addUserDialog=!0}},null,8,["onClick"]),(0,a.Wm)(f,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:s=>g.openDialog("deleteUser",e.data)},null,8,["onClick"])])),_:1})])),_:1},8,["expandedRows","value"]),(0,a.Wm)(k,null,{start:(0,a.w5)((()=>[(0,a.Wm)(f,{label:"Add new user",icon:"pi pi-user-plus",class:"mr-2 p-button-success",onClick:s[1]||(s[1]=e=>{v.userToEdit=void 0,v.addUserDialog=!0})})])),_:1}),(0,a.Wm)(U,{visible:v.deleteDialog.visible,"onUpdate:visible":s[4]||(s[4]=e=>v.deleteDialog.visible=e),style:{width:"450px"},header:v.deleteDialog.header,modal:!0},{footer:(0,a.w5)((()=>[(0,a.Wm)(f,{label:"No",icon:"pi pi-times",class:"p-button-text",style:{color:"var(--orange-300)"},onClick:s[2]||(s[2]=e=>v.deleteDialog.visible=!1)}),(0,a.Wm)(f,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:s[3]||(s[3]=e=>g.deleteResource())})])),default:(0,a.w5)((()=>[(0,a._)("div",m,[p,v.userToChange?((0,a.wg)(),(0,a.iD)("span",h,(0,t.zw)(v.deleteDialog.text),1)):(0,a.kq)("",!0)])])),_:1},8,["visible","header"]),(0,a.Wm)(D,{users:v.users,"edit-user":v.userToEdit,visible:v.addUserDialog,onClose:g.closeAddUserDialog},null,8,["users","edit-user","visible","onClose"])])}const g=e=>((0,a.dD)("data-v-ec38c472"),e=e(),(0,a.Cn)(),e),b={class:"p-fluid grid"},f={class:"p-float-label p-my-4"},y=g((()=>(0,a._)("label",{for:"username"},"Username",-1))),w={class:"p-float-label p-my-4"},k=g((()=>(0,a._)("label",{for:"firstname"},"User First Name",-1))),U={class:"p-float-label p-my-4"},D=g((()=>(0,a._)("label",{for:"lastname"},"User Surname",-1))),C={class:"p-float-label p-my-4"},_=g((()=>(0,a._)("label",{for:"email"},"User E-mail",-1))),x={class:"p-float-label p-my-4"},W=g((()=>(0,a._)("label",{for:"email"},"User Password",-1)));function T(e,s,l,i,o,r){const d=(0,a.up)("InputText"),n=(0,a.up)("Password"),u=(0,a.up)("ToggleButton"),c=(0,a.up)("Button"),m=(0,a.up)("Dialog");return(0,a.wg)(),(0,a.j4)(m,{visible:l.visible,style:{width:"450px"},header:"Add new user",modal:!0,"onUpdate:visible":r.cancelAdd},{footer:(0,a.w5)((()=>[(0,a.Wm)(c,{label:"No",icon:"pi pi-times",class:"p-button-text p-left",style:{color:"var(--orange-300)"},onClick:s[6]||(s[6]=e=>r.cancelAdd())}),(0,a.Wm)(c,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:s[7]||(s[7]=e=>r.confirmAdd())})])),default:(0,a.w5)((()=>[(0,a._)("div",b,[(0,a._)("span",f,[(0,a.Wm)(d,{id:"username",modelValue:o.user.username,"onUpdate:modelValue":s[0]||(s[0]=e=>o.user.username=e),type:"text",class:(0,t.C_)(o.error.username?"p-invalid":"")},null,8,["modelValue","class"]),y]),(0,a._)("span",w,[(0,a.Wm)(d,{id:"firstname",modelValue:o.user.firstName,"onUpdate:modelValue":s[1]||(s[1]=e=>o.user.firstName=e),type:"text"},null,8,["modelValue"]),k]),(0,a._)("span",U,[(0,a.Wm)(d,{id:"lastname",modelValue:o.user.lastName,"onUpdate:modelValue":s[2]||(s[2]=e=>o.user.lastName=e),type:"text"},null,8,["modelValue"]),D]),(0,a._)("span",C,[(0,a.Wm)(d,{id:"email",modelValue:o.user.email,"onUpdate:modelValue":s[3]||(s[3]=e=>o.user.email=e),type:"text",class:(0,t.C_)(o.error.email?"p-invalid":"")},null,8,["modelValue","class"]),_]),(0,a._)("span",x,[(0,a.Wm)(n,{id:"password",modelValue:o.user.credentials[0].value,"onUpdate:modelValue":s[4]||(s[4]=e=>o.user.credentials[0].value=e),class:(0,t.C_)(o.error.password?"p-invalid":"")},null,8,["modelValue","class"]),W]),(0,a.Wm)(u,{modelValue:o.user.credentials[0].temporary,"onUpdate:modelValue":s[5]||(s[5]=e=>o.user.credentials[0].temporary=e),"on-label":"Temporal Password","off-label":"Permanent Password","on-icon":"pi pi-check","off-icon":"pi pi-times"},null,8,["modelValue"])])])),_:1},8,["visible","onUpdate:visible"])}var R={name:"UserAdd",props:{users:{type:Array,required:!0},editUser:{type:Object,required:!1,default:void 0},visible:Boolean},emits:["close"],data(){return{user:{enabled:!0,attributes:{},groups:[],username:void 0,firstName:void 0,lastName:void 0,email:void 0,emailVerified:"false",credentials:[{type:"password",value:void 0,temporary:!0}]},error:{username:!1,email:!1,password:!1}}},watch:{visible:function(e){e?void 0!=this.editUser&&(this.user=this.editUser,this.user.credentials=[{type:"password",value:void 0,temporary:!0}],delete this.user.roles,delete this.user.name):this.reset()}},methods:{confirmAdd(){let e=!1;console.error(this.user);for(let s of this.users)void 0!==this.user.username&&(this.user.username!==s.username||void 0!=this.editUser&&this.user.username==this.editUser.username)||(e=!0,this.error.username=!0),void 0==this.user.email||this.user.email!==s.email||void 0!=this.editUser&&this.user.email==this.editUser.email||(e=!0,this.error.email=!0);void 0!=this.editUser&&void 0===this.user.credentials[0].value?delete this.user.credentials:void 0!==this.user.credentials[0].value&&0!=this.user.credentials[0].value||(e=!0,this.error.password=!0),e||void 0!==this.editUser?e||this.$keycloak.updateUser(this.user).then((()=>{this.$emit("close",this.user)})):this.$keycloak.createUser(this.user).then((()=>{this.$emit("close",this.user)}))},cancelAdd(){this.$emit("close",void 0)},reset(){Object.assign(this.$data,this.$options.data.apply(this))}}},A=l(3744);const V=(0,A.Z)(R,[["render",T],["__scopeId","data-v-ec38c472"]]);var $=V,N={name:"Users",components:{UserAdd:$},data(){return{users:[],roles:[],userToEdit:void 0,userToChange:void 0,roleToChange:void 0,deleteDialog:{visible:!1,header:"Delete",text:"Are you sure to delete this",delete:void 0},addUserDialog:!1}},async created(){this.users=await this.$keycloak.getUsers(),this.roles=await this.$keycloak.getClientRoles()},mounted(){},methods:{availableRoles(e){let s=this.roles.map((e=>({...e})));for(let l of e.roles)s.splice(s.map((e=>e.id)).indexOf(l.id),1);return void 0!=s&&s.length>0&&(e.addRole=s[0]),s},openDialog(e,s,l){switch(this.userToChange=s,this.roleToChange=l,e){case"deleteRole":this.deleteDialog.delete="role",this.deleteDialog.header="Delete Role",this.deleteDialog.text=`Are you sure to delete ${l.name} role from ${s.username}?`,this.deleteDialog.visible=!0;break;case"deleteUser":this.deleteDialog.delete="user",this.deleteDialog.header="Delete User",this.deleteDialog.text=`Are you sure to delete ${s.username}? This action cannot be reversed`,this.deleteDialog.visible=!0;break;default:this.deleteDialog.delete=void 0;break}},async closeAddUserDialog(e){void 0!=e&&(this.users=await this.$keycloak.getUsers(),console.log(this.users)),this.addUserDialog=!1},addRole(e){void 0!=e.addRole&&(console.error(e.addRole),this.$keycloak.assignRolesToUser(e.id,Array(e.addRole)),e.roles.push(e.addRole))},selectRole(e,s){s.addRole=JSON.parse(e.target.value)},deleteResource(){if("role"==this.deleteDialog.delete&&this.userToChange&&this.roleToChange){let e=this.users[this.users.indexOf(this.userToChange)];console.error(e),this.$keycloak.unAssignRolesToUser(this.userToChange.id,Array(this.roleToChange)),e.roles.splice(e.roles.indexOf(this.roleToChange),1),this.deleteDialog.visible=!1,this.deleteDialog.delete=void 0}else"user"==this.deleteDialog.delete&&this.userToChange&&(this.$keycloak.deleteUser(this.userToChange.id),this.users.splice(this.users.indexOf(this.userToChange),1),this.deleteDialog.visible=!1,this.deleteDialog.delete=void 0)}}};const O=(0,A.Z)(N,[["render",v],["__scopeId","data-v-7dd8a968"]]);var E=O}}]);
//# sourceMappingURL=533.2c6fdba7.js.map